#-----------------------------------------------------------------------------------------------------------------
# Example configuration for enabling TLS for each of the Spinnaker Services.
#
# Prerequisites:
#   - Certificate, key, and CA certificate should be generated and loaded into a secret for each of the services.
#   - All of the certificates for the services should be signed by the same CA.  This can be a self-signed CA.
#   - The CA certificate should be loaded into an already existing truststore (from the Java install) and loaded
#     into a secret.
#-----------------------------------------------------------------------------------------------------------------
apiVersion: spinnaker.armory.io/v1alpha2
kind: SpinnakerService
metadata:
  name: spinnaker
spec:
  spinnakerConfig:
    service-settings:
      front50:
        # Mount the keystore and truststore secrets to the container
        kubernetes:
          volumes:
          - id: front50-cert
            type: secret
            mountPath: /front50-cert
          - id: truststore
            type: secret
            mountPath: /truststore
        # Update the scheme to let Halyard know to configure this service with HTTPS URLs
        scheme: https
      clouddriver:
        # Mount the keystore and truststore secrets to the container
        kubernetes:
          volumes:
          - id: clouddriver-cert
            type: secret
            mountPath: /clouddriver-cert
          - id: truststore
            type: secret
            mountPath: /truststore
        # Update the scheme to let Halyard know to configure this service with HTTPS URLs
        scheme: https
      orca:
        # Mount the keystore and truststore secrets to the container
        kubernetes:
          volumes:
          - id: orca-cert
            type: secret
            mountPath: /orca-cert
          - id: truststore
            type: secret
            mountPath: /truststore
        # Update the scheme to let Halyard know to configure this service with HTTPS URLs
        scheme: https
      echo:
        # Mount the keystore and truststore secrets to the container
        kubernetes:
          volumes:
          - id: echo-cert
            type: secret
            mountPath: /echo-cert
          - id: truststore
            type: secret
            mountPath: /truststore
        # Update the scheme to let Halyard know to configure this service with HTTPS URLs
        scheme: https
      fiat:
        # Mount the keystore and truststore secrets to the container
        kubernetes:
          volumes:
          - id: fiat-cert
            type: secret
            mountPath: /fiat-cert
          - id: truststore
            type: secret
            mountPath: /truststore
        # Update the scheme to let Halyard know to configure this service with HTTPS URLs
        scheme: https
      gate:
        # Mount the keystore and truststore secrets to the container
        kubernetes:
          volumes:
          - id: gate-cert
            type: secret
            mountPath: /gate-cert
          - id: truststore
            type: secret
            mountPath: /truststore
        # Update the scheme to let Halyard know to configure this service with HTTPS URLs
        scheme: https
      igor:
        # Mount the keystore and truststore secrets to the container
        kubernetes:
          volumes:
          - id: igor-cert
            type: secret
            mountPath: /igor-cert
          - id: truststore
            type: secret
            mountPath: /truststore
        # Update the scheme to let Halyard know to configure this service with HTTPS URLs
        scheme: https
      kayenta:
        # Mount the keystore and truststore secrets to the container
        kubernetes:
          volumes:
          - id: kayenta-cert
            type: secret
            mountPath: /kayenta-cert
          - id: truststore
            type: secret
            mountPath: /truststore
        # Update the scheme to let Halyard know to configure this service with HTTPS URLs
        scheme: https
      rosco:
        # Mount the keystore and truststore secrets to the container
        kubernetes:
          volumes:
          - id: rosco-cert
            type: secret
            mountPath: /rosco-cert
          - id: truststore
            type: secret
            mountPath: /truststore
        # Update the scheme to let Halyard know to configure this service with HTTPS URLs
        scheme: https
      dinghy:
        # Mount the certs to the container.  The Truststore is not needed as this is a GoLang Service.
        kubernetes:
          volumes:
          - id: dinghy-cert
            type: secret
            mountPath: /dinghy-cert
        # Update the scheme to let Halyard know to configure this service with HTTPS URLs
        scheme: https
      terraformer:
        # Mount the certs to the container.  The Truststore is not needed as this is a GoLang Service.
        kubernetes:
          volumes:
          - id: terraformer-cert
            type: secret
            mountPath: /terraformer-cert
        # Update the scheme to let Halyard know to configure this service with HTTPS URLs
        scheme: https
    profiles:
      front50:
        server:
          ssl:
            # Enable TLS and set the keystore, certs, and trustore for the Server component of the service
            enabled: true
            key-store: /front50-cert/keystore.jks
            key-store-type: jks
            # This should match the password set when the keystore was created
            key-store-password: encrypted:k8s!n:spin-secrets!k:front50-keystore-password
            # This should match the alias used when adding the cert to the keystore
            key-alias: front50
            trust-store: /truststore/truststore.jks
            trust-store-type: jks
            trust-store-password: changeit
      clouddriver:
        server:
          ssl:
            # Enable TLS and set the keystore, certs, and trustore for the Server component of the service
            enabled: true
            key-store: /clouddriver-cert/keystore.jks
            key-store-type: jks
            # This should match the password set when the keystore was created
            key-store-password: encrypted:k8s!n:spin-secrets!k:clouddriver-keystore-password
            # This should match the alias used when adding the cert to the keystore
            key-alias: front50
            trust-store: /truststore/truststore.jks
            trust-store-type: jks
            trust-store-password: changeit
      orca:
        server:
          ssl:
            # Enable TLS and set the keystore, certs, and trustore for the Server component of the service
            enabled: true
            key-store: /orca-cert/keystore.jks
            key-store-type: jks
            # This should match the password set when the keystore was created
            key-store-password: encrypted:k8s!n:spin-secrets!k:orca-keystore-password
            # This should match the alias used when adding the cert to the keystore
            key-alias: front50
            trust-store: /truststore/truststore.jks
            trust-store-type: jks
            trust-store-password: changeit
      echo:
        server:
          ssl:
            # Enable TLS and set the keystore, certs, and trustore for the Server component of the service
            enabled: true
            key-store: /echo-cert/keystore.jks
            key-store-type: jks
            # This should match the password set when the keystore was created
            key-store-password: encrypted:k8s!n:spin-secrets!k:echo-keystore-password
            # This should match the alias used when adding the cert to the keystore
            key-alias: front50
            trust-store: /truststore/truststore.jks
            trust-store-type: jks
            trust-store-password: changeit
      fiat:
        server:
          ssl:
            # Enable TLS and set the keystore, certs, and trustore for the Server component of the service
            enabled: true
            key-store: /fiat-cert/keystore.jks
            key-store-type: jks
            # This should match the password set when the keystore was created
            key-store-password: encrypted:k8s!n:spin-secrets!k:fiat-keystore-password
            # This should match the alias used when adding the cert to the keystore
            key-alias: front50
            trust-store: /truststore/truststore.jks
            trust-store-type: jks
            trust-store-password: changeit
      gate:
        server:
          ssl:
            # Enable TLS and set the keystore, certs, and trustore for the Server component of the service
            enabled: true
            key-store: /gate-cert/keystore.jks
            key-store-type: jks
            # This should match the password set when the keystore was created
            key-store-password: encrypted:k8s!n:spin-secrets!k:gate-keystore-password
            # This should match the alias used when adding the cert to the keystore
            key-alias: front50
            trust-store: /truststore/truststore.jks
            trust-store-type: jks
            trust-store-password: changeit
      igor:
        server:
          ssl:
            # Enable TLS and set the keystore, certs, and trustore for the Server component of the service
            enabled: true
            key-store: /igor-cert/keystore.jks
            key-store-type: jks
            # This should match the password set when the keystore was created
            key-store-password: encrypted:k8s!n:spin-secrets!k:igor-keystore-password
            # This should match the alias used when adding the cert to the keystore
            key-alias: front50
            trust-store: /truststore/truststore.jks
            trust-store-type: jks
            trust-store-password: changeit
      kayenta:
        server:
          ssl:
            # Enable TLS and set the keystore, certs, and trustore for the Server component of the service
            enabled: true
            key-store: /kayenta-cert/keystore.jks
            key-store-type: jks
            # This should match the password set when the keystore was created
            key-store-password: encrypted:k8s!n:spin-secrets!k:kayenta-keystore-password
            # This should match the alias used when adding the cert to the keystore
            key-alias: front50
            trust-store: /truststore/truststore.jks
            trust-store-type: jks
            trust-store-password: changeit
      rosco:
        server:
          ssl:
            # Enable TLS and set the keystore, certs, and trustore for the Server component of the service
            enabled: true
            key-store: /rosco-cert/keystore.jks
            key-store-type: jks
            # This should match the password set when the keystore was created
            key-store-password: encrypted:k8s!n:spin-secrets!k:rosco-keystore-password
            # This should match the alias used when adding the cert to the keystore
            key-alias: front50
            trust-store: /truststore/truststore.jks
            trust-store-type: jks
            trust-store-password: changeit
      dinghy:
        server:
          ssl:
            # Enable TLS and set the certificate, key, and CA.  This is different as it's a GoLang based service.
            enabled: true
            certFile: /dinghy-cert/tls.crt
            keyFile: /dinghy-cert/tls.key
            # This should match the password set when the certificate/private key was created
            keyPassword: encrypted:k8s!n:spin-secrets!k:dinghy-key-password
            cacertFile: /dinghy-cert/ca.crt
      terraformer:
        server:
          ssl:
            # Enable TLS and set the certificate, key, and CA.  This is different as it's a GoLang based service.
            enabled: true
            certFile: /terraformer-cert/tls.crt
            keyFile: /terraformer-cert/tls.key
            # This should match the password set when the certificate/private key was created
            keyPassword: encrypted:k8s!n:spin-secrets!k:terraformer-key-password
            cacertFile: /terraformer-cert/ca.crt
